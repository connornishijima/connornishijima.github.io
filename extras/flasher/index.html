<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

        <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>

        <style>
            body{
                color: #fff;
                background-color: #000;
                font-family: "Quicksand", serif;
                font-optical-sizing: auto;
                font-weight: 400;
                font-style: normal;
            }
            #flasher_logo{
                width:100%;
                max-width: 400px;
                display:block; 
                margin: 40px auto;
            }

            .install_button{
                color: #000;
                background-color: #05ad8e;
                padding: 10px;
                border-radius: 8px;
                display: block;
                margin: 15px auto;
                border:none;
            }

            #content{
                max-width: 400px;
                margin: 0px auto;
                text-align: center;
            }

            .step{
                margin-bottom: 15px;
            }

            .step_label{
                margin-bottom: 10px;
                font-size: 24px;
            }

            .product_picker{
                background-color: #f36725;
                font-family: 'Quicksand';
                color: #fff;
                font-size: 18px;
                padding: 10px;
                border: none;
                border-radius: 10px;
                font-weight: 800;
                display: block;
                width: 100%;
            }
            
        </style>
    </head>
    <body onload="init_system();">
        <img id="flasher_logo" src="img/device_recovery.png" />
        
        <div id="content">
            <div class="step" id="step1">
                <select id="product_model" class="product_picker" onchange="update_menu();">
                    <option id="null" selected>Choose A Product...</option>
                    <option id="fluora_floor">Fluora (Floor Model)</option>
                    <option id="fluora_mini">Fluora Mini</option>
                    <option id="monos">Monos</option>
                </select>
            </div>
            
            <div class="step" id="step2" style="display:none;">         
                <select id="firmware_version" class="product_picker" onchange="update_menu();">
                    <option id="null" selected>Choose A Firmware Version...</option>
                    <option id="v200">2.0.0</option>
                    <option id="v144">1.4.4</option>
                    <option id="v135">1.3.5</option>
                </select>
            </div>

            <div class="step" id="step3" style="display:none;">
                <div class="step_label">Install Software:</div>           
                
                <esp-web-install-button manifest="https://connor.nishiji.ma/extras/flasher/v200/floor/manifest.json">
                    <button class="install_button" slot="activate">Install 2.0.0 (Fluora Floor)</button>
                    <span slot="unsupported">Ah snap, your browser doesn't work! Sorry, this only works on desktop Chrome so far. :(</span>
                    <span slot="not-allowed">Sorry pal you can't use the flasher without HTTPS...</span>
                </esp-web-install-button>
            </div>
        </div>

        <script>
            let pixelair_manifest = {};

            function init_system(){
                fetch('pixelair_manifest.json')
                .then(response => {
                    if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json(); // Parse the JSON from the response
                })
                .then(data => {
                    pixelair_manifest = data;
                    console.log('PixelAir Manifest:', pixelair_manifest); // Access the JSON data
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });

                update_menu();
            }
            
            function update_menu(){
                let product_model = document.getElementById("product_model");
                let product_model_selected = product_model.options[product_model.selectedIndex];

                let firmware_version = document.getElementById("firmware_version");
                let firmware_version_selected = firmware_version.options[firmware_version.selectedIndex];

                console.log("product_model set to:    " + product_model_selected.id);
                console.log("firmware version set to: " + firmware_version_selected.id);

                // parse json

                // set contents of dropdowns
            
                /*
                product_model.innerHTML = '';
            
                    <option id="null" selected>Choose A Product...</option>
                    <option id="fluora_floor">Fluora (Floor Model)</option>
                    <option id="fluora_mini">Fluora Mini</option>
                    <option id="monos">Monos</option>
                */



                // Show dropdowns

                if (product_model_selected.id == "null") {
                    document.getElementById("step2").style.display = "none";
                    document.getElementById("step3").style.display = "none";
                }
                else{
                    document.getElementById("step2").style.display = "block";

                    if (firmware_version_selected.id == "null") {
                        document.getElementById("step3").style.display = "none";
                    }
                    else{
                        document.getElementById("step3").style.display = "block";
                    }
                }

                
            }
        </script>
    </body>
</html>